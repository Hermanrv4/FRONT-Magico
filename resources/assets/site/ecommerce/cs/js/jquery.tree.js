/* checktree/js/jquery.tree.js */
!function(e,n){e.widget("daredevel.tree",{_attachLi:function(t,i,s){var c=i.find("ul:first");c.length?n==s||c.children("li").length<s?c.append(t):(0==s&&(s+=1),c.children("li:nth-child("+s+")").before(t)):(c=e("<ul/>"),i.append(c.append(t)))},_attachNode:function(e,t,i,s){if(s==n&&(s=!0),n==t){var c=this.element;this._attachLi(e,c,i),this._initNode(e)}else{c=t;this._attachLi(e,c,i),s?c.removeClass("leaf collapsed").addClass("expanded"):c.removeClass("leaf").addClass("collapsed"),this._initNode(e),this._initNode(c)}},_buildNode:function(n){n=e.extend(!0,this.options.defaultNodeAttributes,n);var t=e("<span/>",n.span),i=e("<li/>",n.li);if(e.inArray("checkbox",this.options.components)>-1){var s=e("<input/>",n.input);i.append(s)}return i.append(t),i},_create:function(){var n=this;this.element.addClass(" daredevel-tree"),this.options.checkbox&&this._initCheckboxTree(),this.options.collapsible&&this._initCollapsibleTree(),this.options.dnd&&this._initDndTree(),this.options.selectable&&this._initSelectableTree(),this.options.lazyLoading&&this._initLazyTree(),this.element.find("li").each(function(){n._initNode(e(this))}),null!=this.options.nodes&&this.options.nodes instanceof Object&&n._initFromObject(this.options.nodes),null!=this.options.nodesInitUrl&&n._initFromAjax(this.options.nodesInitUrl)},_destroy:function(){this.element.removeClass("daredevel-tree"),this._destroyCheckboxTree(),this._destroyCollapsibleTree()},_destroyCheckboxTree:function(){this.element.off("click","input:checkbox:not(:checked)"),this.element.off("click","input:checkbox:checked"),this.element.off("click","input:checkbox:not(:checked)"),this.element.off("click","input:checkbox:not(:checked)"),this.element.off("click","input:checkbox:checked"),this.element.off("click","input:checkbox:checked")},_destroyCollapsibleTree:function(){this.element.off("click","li span.daredevel-tree-anchor"),this.element.find().removeClass("leaf expanded collapsed"),this.element.find("span.daredevel-tree-anchor").remove()},_detachNode:function(e){var n=this.parentNode(e),t=n.find("ul:first");1==t.children().length?(t.detach(),n.removeClass("collapsed expanded").addClass("leaf")):e.detach(),this._initNode(n)},_initNode:function(e){e.children("span:last").addClass("daredevel-tree-label"),this.options.checkbox&&this._initCheckboxNode(e),this.options.collapsible&&this._initCollapsibleNode(e),this.options.dnd&&this._initDndNode(e),this.options.selectable&&this._initSelectableNode(e),this.options.lazyLoading&&this._initLazyNode(e)},_initFromObject:function(n){var t=this;e.each(n,function(e,n){t.addNode(n)})},addNode:function(t,i,s,c){var o=this,a=this._buildNode(t);n==i||0==i.length?this._attachNode(e(a),n,s,!1):this._attachNode(e(a),e(i),s,c),n!=t.children&&e.each(t.children,function(e,n){o.addNode(n,a)}),o._trigger("add",!0,a)},isRoot:function(n){return 1==(n=e(n)).parentsUntil(".daredevel-tree").length},moveNode:function(t,i,s){this._detachNode(e(t)),n==i||0==i.length?this._attachNode(e(t),n,s):this._attachNode(e(t),e(i),s),this._trigger("move",!0,e(t))},parentNode:function(n){return e(n).parents("li:first")},removeNode:function(n){this._detachNode(e(n)),this._trigger("remove",!0,e(n))},_allDescendantChecked:function(e){return 0==e.find("li input:checkbox:not(:checked)").length},_allDescendantUnChecked:function(e){return 0==e.find("li input:checkbox:checked").length},_checkAncestors:function(e){e.parentsUntil("daredevel-tree").filter("li").find("input:checkbox:first:not(:checked)").prop("checked",!0).change()},_checkDescendants:function(e){e.find("li input:checkbox:not(:checked)").prop("checked",!0).change()},_checkOthers:function(n){n.addClass("exclude"),n.parents("li").addClass("exclude"),n.find("li").addClass("exclude"),e(this.element).find("li").each(function(){e(this).hasClass("exclude")||e(this).find("input:checkbox:first:not(:checked)").prop("checked",!0).change()}),e(this.element).find("li").removeClass("exclude")},_initCheckboxTree:function(){var n=this;this.element.on("click","input:checkbox:not(:checked)",function(){n.uncheck(n.parentNode(e(this)))}),this.element.on("click","input:checkbox:checked",function(){n.check(n.parentNode(e(this)))}),"collapse"==this.options.onUncheck.node?this.element.on("click","input:checkbox:not(:checked)",function(){n.collapse(n.parentNode(e(this)))}):"expand"==this.options.onUncheck.node&&this.element.on("click","input:checkbox:not(:checked)",function(){n.expand(n.parentNode(e(this)))}),"collapse"==this.options.onCheck.node?this.element.on("click","input:checkbox:checked",function(){n.collapse(n.parentNode(e(this)))}):"expand"==this.options.onCheck.node&&this.element.on("click","input:checkbox:checked",function(){n.expand(n.parentNode(e(this)))})},_initCheckboxNode:function(e){},_uncheckAncestors:function(e){e.parentsUntil("daredevel-tree").filter("li").find("input:checkbox:first:checked").prop("checked",!1).change()},_uncheckDescendants:function(e){e.find("li input:checkbox:checked").prop("checked",!1).change()},_uncheckOthers:function(n){n.addClass("exclude"),n.parents("li").addClass("exclude"),n.find("li").addClass("exclude"),e(this.element).find("li").each(function(){e(this).hasClass("exclude")||e(this).find("input:checkbox:first:checked").prop("checked",!1).change()}),e(this.element).find("li").removeClass("exclude")},check:function(n){if((n=e(n)).find("input:checkbox:first:not(:checked)").prop("checked",!0).change(),"check"==this.options.onCheck.others?this._checkOthers(n):"uncheck"==this.options.onCheck.others&&this._uncheckOthers(n),"check"==this.options.onCheck.descendants?this._checkDescendants(n):"uncheck"==this.options.onCheck.descendants&&this._uncheckDescendants(n),"check"==this.options.onCheck.ancestors)this._checkAncestors(n);else if("uncheck"==this.options.onCheck.ancestors)this._uncheckAncestors(n);else if("checkIfFull"==this.options.onCheck.ancestors){var t=this.isRoot(n),i=this._allDescendantChecked(this.parentNode(n));!t&&i&&this.check(this.parentNode(n))}},checkAll:function(){e(this.element).find("input:checkbox:not(:checked)").prop("checked",!0).change()},uncheck:function(n){if((n=e(n)).find("input:checkbox:first:checked").prop("checked",!1).change(),"check"==this.options.onUncheck.others?this._checkOthers(n):"uncheck"==this.options.onUncheck.others&&this._uncheckOthers(n),"check"==this.options.onUncheck.descendants?this._checkDescendants(n):"uncheck"==this.options.onUncheck.descendants&&this._uncheckDescendants(n),"check"==this.options.onUncheck.ancestors)this._checkAncestors(n);else if("uncheck"==this.options.onUncheck.ancestors)this._uncheckAncestors(n);else if("checkIfFull"==this.options.onUncheck.ancestors){var t=this.isRoot(n),i=this._allDescendantUnChecked(this.parentNode(n));!t&&i&&this.uncheck(this.parentNode(n))}},uncheckAll:function(){e(this.element).find("input:checkbox:checked").prop("checked",!1).change()},_initCollapsibleTree:function(){var n=this;this.element.on("click","li span.daredevel-tree-anchor",function(){var t=n.parentNode(e(this));t.hasClass("collapsed")?n.expand(t):t.hasClass("expanded")&&n.collapse(t)})},_initCollapsibleNode:function(n){var t=this;n.children("span.daredevel-tree-anchor").length<1&&n.prepend(e("<span />",{class:"daredevel-tree-anchor"})),n.hasClass("leaf")?t._markAsLeaf(n):n.hasClass("collapsed")?t.collapse(n,!1,!0):n.hasClass("expanded")?t.expand(n,!1,!0):n.is("li:not(:has(ul))")?t._markAsLeaf(n):t._markAsExpanded(n)},_markAsCollapsed:function(e){var n=e.children("span.daredevel-tree-anchor");n.removeClass("ui-icon "+this.options.expandUiIcon+" "+this.options.leafUiIcon),this.options.collapseUiIcon.length>0&&n.addClass("ui-icon "+this.options.collapseUiIcon),e.removeClass("leaf").removeClass("expanded").addClass("collapsed")},_markAsExpanded:function(e){var n=e.children("span.daredevel-tree-anchor");n.removeClass("ui-icon "+this.options.collapseUiIcon+" "+this.options.leafUiIcon),this.options.expandUiIcon.length>0&&n.addClass("ui-icon "+this.options.expandUiIcon),e.removeClass("leaf").removeClass("collapsed").addClass("expanded")},_markAsLeaf:function(e){var n=e.children("span.daredevel-tree-anchor");n.removeClass("ui-icon "+this.options.collapseUiIcon+" "+this.options.expandUiIcon),this.options.leafUiIcon.length>0&&n.addClass("ui-icon "+this.options.leafUiIcon),e.removeClass("collapsed").removeClass("expanded").addClass("leaf")},_unmark:function(){li.removeClass("collapsed expanded leaf")},collapse:function(t,i,s){if(t=e(t),s==n&&(s=!1),s||!t.hasClass("collapsed")&&!t.hasClass("leaf")){i==n&&(i=!0);var c=this;i?(t.children("ul").hide(this.options.collapseEffect,{},this.options.collapseDuration),setTimeout(function(){c._markAsCollapsed(t,c.options)},c.options.collapseDuration)):(t.children("ul").hide(),c._markAsCollapsed(t,c.options)),c._trigger("collapse",!0,t)}},collapseAll:function(){var n=this;e(this.element).find("li.expanded").each(function(){n.collapse(e(this))})},expand:function(t,i,s){if(t=e(t),s==n&&(s=!1),s||!t.hasClass("expanded")&&!t.hasClass("leaf")){i==n&&(i=!0);var c=this;c._trigger("preexpand",!0,t),i?(t.children("ul").show(c.options.expandEffect,{},c.options.expandDuration),setTimeout(function(){c._markAsExpanded(t,c.options)},c.options.expandDuration)):(t.children("ul").show(),c._markAsExpanded(t,c.options)),c._trigger("expand",!0,t)}},expandAll:function(){var n=this;e(this.element).find("li.collapsed").each(function(){n.expand(e(this))})},_initDndTree:function(){},_initDndNode:function(t){var i=this,s=e("<span/>",{class:"prepended",html:"<br/>"}).droppable({hoverClass:"over",drop:function(t,s){var c=e(this).closest("li");if(i.isRoot(c)){var o=n;i.element}else{o=c.parent().closest("li");if(e(s.draggable.parent("li")).find(o).length)return}var a=e(e(this).parent("li")).index()+1;i.moveNode(s.draggable.parent("li"),o,a),i._trigger("drop",t,{draggable:s.draggable,droppable:o})}});e(t).find(".daredevel-tree-label:first").after(s),e(t).find(".daredevel-tree-label:first").draggable({start:function(n,t){e(this).parent("li").find("ul, .prepended").css("visibility","hidden"),e(this).parent("li").find(".droppable-label").css("display","none")},stop:function(n,t){e(this).parent("li").find("ul").css("visibility","visible"),e(this).parent("li").find(".prepended").css("visibility",""),e(this).parent("li").find(".droppable-label").css("display","inherit")},revert:!0,revertDuration:0});s=e("<span/>",{class:"droppable-label",html:"<br/>"}).droppable({drop:function(n,t){var s=e(this).closest("li");e(t.draggable.parent("li")).find(s).length||(i.moveNode(t.draggable.parent("li"),s,1),i._trigger("drop",n,{draggable:t.draggable,droppable:s}))},over:function(n,t){e(this).parent("li").find(".daredevel-tree-label:first").addClass("ui-state-hover")},out:function(n,t){e(this).parent("li").find(".daredevel-tree-label:first").removeClass("ui-state-hover")}});e(t).find(".daredevel-tree-label:first").after(s)},_initSelectableTree:function(){var n=this;this.element.on("click",".daredevel-tree-label",function(){var t=e(this);t.hasClass(n.options.selectUiClass)?n.deselect(e(this).parent(t)):n.select(e(this).parent("li"))})},_deselect:function(e){e.find("span.daredevel-tree-label:first").removeClass(this.options.selectUiClass),this._trigger("deselect",!0,e)},_deselectAll:function(){var n=this;this.element.find(".daredevel-tree-label."+this.options.selectUiClass).each(function(){n._deselect(e(this).parent("li"))})},_destroySelectable:function(){},_initSelectableNode:function(e){},_select:function(e){e.find("span.daredevel-tree-label:first").addClass(this.options.selectUiClass),this._trigger("select",!0,e)},deselect:function(n){n=e(n),this._deselect(n)},select:function(n){n=e(n),this.options.selectUnique&&this._deselectAll(),this._select(n)},selected:function(){var n=this.element.find(".daredevel-tree-label."+this.options.selectUiClass);return e(n).parent()},_initLazyTree:function(){var n=this;this.options.lazyLoading&&n.element.on("treepreexpand",function(t,i){e(this);e(i).find("ul").length||n._lazyAdd(n.options.nodesLazyUrl,e(i))})},_initLazyNode:function(e){},_initFromAjax:function(n){var t=this;e.ajax({url:n,dataType:"json",beforeSend:function(){},complete:function(){},data:{},success:function(n){e.each(n.nodes,function(e,n){t.addNode(n)})}})},_lazyAdd:function(t,i){var s=this;e.ajax({async:!1,url:t,dataType:"json",data:{node:i.attr("id")},success:function(t){e.each(t.nodes,function(e,t){s.addNode(t,i,n,!1)})}})},options:{defaultNodeAttributes:{span:{html:"new node"},li:{class:"leaf"},input:{type:"checkbox"}},nodes:null,checkbox:!0,onCheck:{ancestors:"check",descendants:"check",node:"",others:""},onUncheck:{ancestors:"",descendants:"uncheck",node:"",others:""},collapsible:!0,collapseDuration:500,collapseEffect:"blind",collapseUiIcon:"ui-icon-triangle-1-e",expandDuration:500,expandEffect:"blind",expandUiIcon:"ui-icon-triangle-1-se",leafUiIcon:"",dnd:!0,drop:function(e,n){},selectable:!0,deselect:function(e,n){},selectUiClass:"ui-state-active",selectUnique:!0,select:function(e,n){},lazyLoading:!1,dataEditUrl:"",nodesInitUrl:"",nodesLazyUrl:""}})}(jQuery);
